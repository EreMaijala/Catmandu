#!/usr/bin/env perl

use Catmandu::Index::Solr;
use Getopt::Long;

my $fields = [qw(id)];

GetOptions ("field=s@" => \$fields);

my $q = shift;

die "usage: $0 query" unless $q;

my $solr = Catmandu::Index::Solr->new();

&query($solr,$q,0);

sub query {
   my ($index,$query,$start) = @_;

   my ($objs,$hits) = $index->search($query, start => $start, limit => 10);

   foreach my $obj (@$objs) {
     foreach my $field (@$fields) {
      printf "%s\n" , $obj->{$field};
     }
   }

   &query($index,$query,$start + 10) if @$objs;
}
